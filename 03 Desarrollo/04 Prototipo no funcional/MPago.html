<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/styles.css">
	<link rel="stylesheet" href="css/Admin.css">
	<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
	<script src="https://kit.fontawesome.com/0b32f2b0be.js"></script>

	<title>ComponenTech</title>
</head>
<body>

	
	<header>
		<div class="logo"><a href="principal.php"><img src="logo.png" alt="l"> </a></div>
		<h1 class="TituloFactura">Factura</h1>
	</div>
	<nav class="navegador">
		<ul>
				<li><a href="principal.php">Inicio</a></li>
				<li><a href="../controlador/salir.php"><i class="fas fa-sign-out-alt"></i></a></li>
				
			</ul>
		</nav>
	</header>
	
	<section class="SeccionFactura">

		<div class="ProductosFactura">
				<div class="producto">
					<input class="precio" type="hidden" value="123456">
					<div class="prodImg">
						<img src="productoEjemplo.png">
					</div>
					<div>
						<div class="prodNombre">
							<p>Producto1</p>
						</div>

						<div class="precios">
							<div class="prodPrecio">
								<p >$123.456</p>
							</div>
							<div class="ProdCant">
								<input name="<?php echo $key ?>" onkeyup="this.value=1;calcularTotalCantidad(this.parentElement.parentElement.parentElement.parentElement)" 
								onkeypress="this.value=1;" class="cantidad" type="number" min="1" max="5" value="1" 
								oninput="calcularTotalCantidad(this.parentElement.parentElement.parentElement.parentElement)" >
							</div>

							<div class="prodTotal">
								<p class="totalCantidad"></p>
							</div>

							<form method="post" action="#" class="SacarProductoFactura">
								<input type="hidden" name="prod" value="<?php echo $key ?>">
								<button type="submit" name="sacarproducto"><i class="fa fa-trash-alt"></i></button>
							</form>
							
						</div>
					</div>
				</div>
				<div class="producto">
					<input class="precio" type="hidden" value="123456">
					<div class="prodImg">
						<img src="productoEjemplo.png">
					</div>
					<div>
						<div class="prodNombre">
							<p>Producto1</p>
						</div>

						<div class="precios">
							<div class="prodPrecio">
								<p >$123.456</p>
							</div>
							<div class="ProdCant">
								<input name="<?php echo $key ?>" onkeyup="this.value=1;calcularTotalCantidad(this.parentElement.parentElement.parentElement.parentElement)" 
								onkeypress="this.value=1;" class="cantidad" type="number" min="1" max="5" value="1" 
								oninput="calcularTotalCantidad(this.parentElement.parentElement.parentElement.parentElement)" >
							</div>

							<div class="prodTotal">
								<p class="totalCantidad"></p>
							</div>

							<form method="post" action="#" class="SacarProductoFactura">
								<input type="hidden" name="prod" value="<?php echo $key ?>">
								<button type="submit" name="sacarproducto"><i class="fa fa-trash-alt"></i></button>
							</form>
							
						</div>
						
						
					</div>
					

				</div>
				<div class="producto">
					<input class="precio" type="hidden" value="123456">
					<div class="prodImg">
						<img src="productoEjemplo.png">
					</div>
					<div>
						<div class="prodNombre">
							<p>Producto1</p>
						</div>

						<div class="precios">
							<div class="prodPrecio">
								<p >$123.456</p>
							</div>
							<div class="ProdCant">
								<input name="<?php echo $key ?>" onkeyup="this.value=1;calcularTotalCantidad(this.parentElement.parentElement.parentElement.parentElement)" 
								onkeypress="this.value=1;" class="cantidad" type="number" min="1" max="5" value="1" 
								oninput="calcularTotalCantidad(this.parentElement.parentElement.parentElement.parentElement)" >
							</div>

							<div class="prodTotal">
								<p class="totalCantidad"></p>
							</div>

							<form method="post" action="#" class="SacarProductoFactura">
								<input type="hidden" name="prod" value="<?php echo $key ?>">
								<button type="submit" name="sacarproducto"><i class="fa fa-trash-alt"></i></button>
							</form>
							
						</div>
						
						
					</div>
					

				</div>
		</div>

		<form class=" MetodosPago CajaFormulario">
			<div>
				<h1>Metodos de pago</h1>
				<div class="totales">
					<h2 class="SubtotalTitulo">Subtotal:</h2>
					<h2 class="SubtotalMP"></h2>
				</div>
				<div class="totales">
					<h2 class="TotalTitulo">Total:</h2>
					<h2 class="TotalMP"> </h2>
				</div>
			</div>

			<div class="OpcionMetodoPago">
				
				<label><input type="radio" name="MetodoP" value="Tarjeta Debito" ><p>Tarjeta Debito</p></label>
				<label><input type="radio" name="MetodoP" value="Tarjeta credito" ><p>Tarjeta Cretido</p></label>
				<label><input type="radio" name="MetodoP" value="Efecty" ><p>Efecty</p></label>
				<label><input type="radio" name="MetodoP" value="Efectivo" ><p>Efectivo</p></label>				
			</div>
			<div>
				<label class="MarcadoFactura">
					<input type="checkbox" name="" id="Terminos"><p>He leido y estoy de acuerdo con los terminos y condiciones de la web.</p>
				</label>
				<button class="submitButton Verificado2" type="button" id="FCompra">Finalizar Compra</button>
			</div>
		</form>

	</section>
</body>
<script>
	var total = 0;
	var subtotal = 0;
	const facturaSubtotal = document.querySelector('.SubtotalMP');

	const facturaTotal = document.querySelector('.TotalMP');

	var prods = document.querySelectorAll('.producto');

	function calcularPrecio(){
		prods = document.querySelectorAll('.producto');
		prods.forEach(e => {
			subtotal += parseInt(desFormat(e.querySelector('.totalCantidad').innerHTML));
		});
		facturaSubtotal.innerHTML = "$" + new Intl.NumberFormat().format(subtotal);
		total = subtotal + (subtotal * 0.19);

		facturaTotal.innerHTML = "$" + new Intl.NumberFormat().format(total);

		subtotal = 0; 

	}

	function desFormat(e){
		return e.replaceAll(".","").replaceAll("$","").replaceAll(",","");
	}

	function calcularTotalCantidad(e){

		let	precioInicial = e.querySelector('.precio').value;
		
		let cantidad = e.querySelector('.cantidad').value;
		let totalCantidad = parseInt(precioInicial)*cantidad;

		e.querySelector('.totalCantidad').innerHTML = "$" + new Intl.NumberFormat().format(totalCantidad);
		calcularPrecio();
	}
	calcularPrecio();
	
	//subtotal += totalCantidad;
	//facturaSubtotal.innerHTML = new Intl.NumberFormat().format(subtotal);
	

	
	prods.forEach(e => {
		calcularTotalCantidad(e);
	});

	const terminar = document.querySelector('#FCompra');
	terminar.addEventListener('click',()=>{
		let selected = false;
		let form = terminar.form;
		let radios = form.querySelectorAll("input[type=radio]");
		let terminos = document.querySelector('#Terminos');
		radios.forEach(e=>{
			if(e.checked==true){
				selected = true;
			}
			
		});

		if(selected){
			if (terminos.checked) {
				form.submit();
			} else {
				swal('Debe aceptar los terminos','','error');
			}
		} else {
			swal('No ha seleccionado un metodo de pago','','error');
		} 

	});


	$('#Terminos').click(function(){

		$('.submitButton').toggleClass("Verificado2");
	});

</script>

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

</html>